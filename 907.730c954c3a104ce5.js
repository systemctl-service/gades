"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[907],{4907:(W,p,s)=>{s.r(p),s.d(p,{OrdenesTrabajoHistoricoComponent:()=>J});var t=s(4946),d=s(6814),g=s(4430),f=s(2814),m=s(2253),h=s(8062),T=s(553),O=s(1063),C=s(8241),c=s(9250),b=s(5219),E=s(707),u=s(95),M=s(4480),x=s(6340),A=s(3714),P=s(3965);const j=["dt"];function v(r,i){1&r&&(t.TgZ(0,"div",12)(1,"h2",13),t._uU(2,"Ordenes de Trabajo"),t.qZA()())}const D=function(){return["nueva"]};function w(r,i){if(1&r){const o=t.EpF();t.TgZ(0,"div",14),t._UZ(1,"button",15),t.TgZ(2,"div",16)(3,"button",17),t.NdJ("click",function(){t.CHM(o);const n=t.oxw(),a=t.MAs(7);return t.KtG(n.clear(a))}),t.qZA(),t.TgZ(4,"p-dropdown",18),t.NdJ("onChange",function(n){t.CHM(o),t.oxw();const a=t.MAs(7);return t.KtG(a.filter(n.value,"estado","contains"))})("ngModelChange",function(n){t.CHM(o);const a=t.oxw();return t.KtG(a.valorNulleable=n)}),t.qZA(),t.TgZ(5,"span",19)(6,"span",20),t._UZ(7,"i",21),t.TgZ(8,"input",22),t.NdJ("input",function(n){t.CHM(o),t.oxw();const a=t.MAs(7);return t.KtG(a.filterGlobal(n.target.value,"contains"))}),t.qZA()()()()()}if(2&r){const o=t.oxw();t.xp6(1),t.Q6J("routerLink",t.DdM(4,D)),t.xp6(3),t.Q6J("options",o.selectEstadoOrden)("ngModel",o.valorNulleable)("showClear",!0)}}function H(r,i){if(1&r&&(t.TgZ(0,"th",26),t._uU(1),t._UZ(2,"p-sortIcon",27),t.qZA()),2&r){const o=t.oxw().$implicit;t.Q6J("pSortableColumn",o.field),t.xp6(1),t.hij(" ",o.header," "),t.xp6(1),t.Q6J("field",o.field)}}function Z(r,i){if(1&r){const o=t.EpF();t.TgZ(0,"p-dropdown",31),t.NdJ("onChange",function(n){const _=t.CHM(o).filterCallback;return t.KtG(_(n))}),t.qZA()}if(2&r){const o=t.oxw(5);t.Q6J("options",o.selectEstadoOrden)}}function y(r,i){if(1&r&&(t.TgZ(0,"p-columnFilter",29),t.YNc(1,Z,1,1,"ng-template",30),t.qZA()),2&r){const o=t.oxw(2).$implicit;t.Q6J("field",o.field)("showMatchModes",!1)("showOperator",!1)("showAddButton",!1)("showApplyButton",!1)("showClearButton",!1)}}function R(r,i){if(1&r&&(t.TgZ(0,"th"),t._uU(1),t.YNc(2,y,2,6,"p-columnFilter",28),t.qZA()),2&r){const o=t.oxw().$implicit;t.xp6(1),t.hij(" ",o.header," "),t.xp6(1),t.Q6J("ngIf","Estado"===o.header)}}function B(r,i){if(1&r&&(t.ynx(0),t.YNc(1,H,3,3,"th",24),t.YNc(2,R,3,2,"ng-template",null,25,t.W1O),t.BQk()),2&r){const o=i.$implicit,e=t.MAs(3);t.xp6(1),t.Q6J("ngIf","Asignado"!==o.header&&"Estado"!==o.header)("ngIfElse",e)}}function I(r,i){if(1&r&&(t.TgZ(0,"tr"),t.YNc(1,B,4,2,"ng-container",23),t.qZA()),2&r){const o=t.oxw();t.xp6(1),t.Q6J("ngForOf",o.cols)}}function U(r,i){if(1&r&&(t.TgZ(0,"td",34)(1,"span",35),t._uU(2),t.qZA(),t._uU(3),t.qZA()),2&r){const o=i.$implicit,e=t.oxw().$implicit;t.xp6(2),t.hij("",o.field," "),t.xp6(1),t.hij(" ",e[o.field]?e[o.field]:"N/A"," ")}}function L(r,i){if(1&r){const o=t.EpF();t.TgZ(0,"tr",32),t.NdJ("click",function(){const a=t.CHM(o).$implicit,_=t.oxw();return t.KtG(_.navegarAMostrar(a.id))}),t.YNc(1,U,4,2,"td",33),t.qZA()}if(2&r){const o=t.oxw();t.xp6(1),t.Q6J("ngForOf",o.cols)}}function F(r,i){1&r&&(t.TgZ(0,"tr")(1,"td"),t._uU(2,"*No hay Ordenes de trabajo registradas*"),t.qZA()())}const N=function(){return[10,20,30]},K=function(){return["descripcion","nombre"]};let J=(()=>{var r;class i{constructor(){this.url=T.N.API_URL,this.totalRecords=0,this.mostrarDel=1,this.mostrarAl=10,this.tareaService=(0,t.f3M)(f.p),this.router=(0,t.f3M)(m.F0),this.usuarioService=(0,t.f3M)(O.i),this.messageService=(0,t.f3M)(h.S),this.enumService=(0,t.f3M)(C.t),this.subs=[],this.cols=[],this.selectEstadoOrden=[],this.ordenesTrabajo=[],this.loading=!0,this.usuarios=[]}ngOnInit(){this.cols=[{field:"nombre",header:"Nombre"},{field:"descripcion",header:"Descripcion"},{field:"estado",header:"Estado"}],this.usuario=JSON.parse(localStorage.getItem("usuario")),this.cargarEstadosOrden()}applyFilterGlobal(e,n){this.dt.filterGlobal(e.target.value,"contains")}cargarEstadosOrden(){this.subs.push(this.enumService.getEnum("estado_orden_trabajo").subscribe({next:e=>this.selectEstadoOrden=e,error:e=>this.messageService.error(e.error.detail)}))}clear(e){e.clear(),document.getElementById("buscador").value="",this.valorNulleable=null}loadCustomers(e){console.log(e),this.loading=!0;const n=e.first?e.first:0,a=e.rows?e.rows:1;var l=this.url+`/ordenes_trabajo_paginate?page=${n/a+1}&itemsPerPage=${a}`;e.globalFilter&&(l+=`&nombre=${e.globalFilter}&descripcion=${e.globalFilter}`),l+=`&usuario=${this.usuario.nombre}`,e.filters.estado&&null!=e.filters.estado&&null!=e.filters.estado.value?l+=`&estado=${e.filters.estado.value}`:e.filters.estado&&null!=e.filters.estado[0]&&null!=e.filters.estado[0].value&&(l+=`&estado=${e.filters.estado[0].value.value}`),e.sortField&&(l+=`&ordenCampo=${e.sortField}`,1==e.sortOrder&&(l+="&ordenTipo=ASC"),-1==e.sortOrder&&(l+="&ordenTipo=DESC")),this.cargarOrdenesTrabajosP(l,n,a)}cargarOrdenesTrabajosP(e,n,a){this.subs.push(this.tareaService.getOrdenesTrabajosPaginadas(e).subscribe(_=>{console.log(_),this.ordenesTrabajo=_.data,this.loading=!1,this.totalRecords=_.totalItems,this.loading=!1,this.mostrarDel=n+1,this.mostrarAl=this.mostrarDel+a-1,this.mostrarAl>this.totalRecords&&(this.mostrarAl=this.totalRecords)},_=>{console.error(_),this.loading=!1,this.messageService.error(_.error.detail)}))}ngOnDestroy(){this.subs.forEach(e=>{e.unsubscribe()})}navegarAMostrar(e){console.log(e),sessionStorage.setItem("lastUrlOrden","/ordenes-trabajos-historico"),this.router.navigateByUrl(`ordenes-trabajo/mostrar/${e}`)}}return(r=i).\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-ordenes-trabajo-historico"]],viewQuery:function(e,n){if(1&e&&t.Gf(j,5),2&e){let a;t.iGM(a=t.CRH())&&(n.dt=a.first)}},standalone:!0,features:[t.jDz],decls:12,vars:16,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["styleClass","toolbar-sin-bordes"],["pTemplate","left"],[1,"mt-1"],["responsiveLayout","scroll","selectionMode","multiple","dataKey","id",3,"value","columns","lazy","loading","paginator","rows","rowsPerPageOptions","totalRecords","globalFilterFields","showCurrentPageReport","currentPageReportTemplate","rowHover","onLazyLoad"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"my-2"],[1,"mb-0"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],["pButton","","pRipple","","type","button","icon","pi pi-plus",1,"p-button-rounded","p-button-success",3,"routerLink"],[1,"flex","flex-column","md:flex-row","md:justify-content-end","md:align-items-center"],["pButton","","label","Filtros","icon","pi pi-filter-slash",1,"mr-2","p-button-outlined","my-2","md:my-0",3,"click"],["id","selctEstado","placeholder","Estado",1,"mr-2","max-w-full",3,"options","ngModel","showClear","onChange","ngModelChange"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"p-input-icon-left","ml-auto"],[1,"pi","pi-search"],["id","buscador","pInputText","","input","","type","text","placeholder","Buscar",1,"max-w-max",3,"input"],[4,"ngFor","ngForOf"],[3,"pSortableColumn",4,"ngIf","ngIfElse"],["asigEstado",""],[3,"pSortableColumn"],[3,"field"],["matchMode","in","display","menu",3,"field","showMatchModes","showOperator","showAddButton","showApplyButton","showClearButton",4,"ngIf"],["matchMode","in","display","menu",3,"field","showMatchModes","showOperator","showAddButton","showApplyButton","showClearButton"],["pTemplate","filter"],["placeholder","Estado de la Orden",1,"w-3rem",3,"options","onChange"],[3,"click"],["style","min-width: 10rem",4,"ngFor","ngForOf"],[2,"min-width","10rem"],[1,"p-column-title"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-toolbar",3),t.YNc(4,v,3,0,"ng-template",4),t.qZA(),t._UZ(5,"hr",5),t.TgZ(6,"p-table",6,7),t.NdJ("onLazyLoad",function(_){return n.loadCustomers(_)}),t.YNc(8,w,9,5,"ng-template",8),t.YNc(9,I,2,1,"ng-template",9),t.YNc(10,L,2,1,"ng-template",10),t.YNc(11,F,3,0,"ng-template",11),t.qZA()()()()),2&e&&(t.xp6(6),t.cQ8("currentPageReportTemplate","Del ",n.mostrarDel," al ",n.mostrarAl," para ",n.totalRecords," Registros"),t.Q6J("value",n.ordenesTrabajo)("columns",n.cols)("lazy",!0)("loading",n.loading)("paginator",!0)("rows",10)("rowsPerPageOptions",t.DdM(14,N))("totalRecords",n.totalRecords)("globalFilterFields",t.DdM(15,K))("showCurrentPageReport",!0)("rowHover",!0))},dependencies:[d.ez,d.sg,d.O5,g.g,c.iA,b.jx,c.lQ,c.fz,c.xl,E.Hq,u.JJ,u.On,M.H,x.o,A.o,P.Lt,m.rH]}),i})()}}]);