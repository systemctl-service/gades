"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[907],{4907:(K,_,n)=>{n.r(_),n.d(_,{OrdenesTrabajoHistoricoComponent:()=>I});var e=n(4946),p=n(6814),u=n(4430),g=n(2814),f=n(2253),h=n(8062),T=n(553),O=n(1063),b=n(8241),c=n(9250),C=n(5219),E=n(707),m=n(95),M=n(6340),P=n(3714),v=n(3965);const D=["dt"];function A(s,d){1&s&&(e.TgZ(0,"div",12)(1,"h2",13),e._uU(2,"Ordenes de Trabajo"),e.qZA()())}function j(s,d){if(1&s){const o=e.EpF();e.TgZ(0,"div",14)(1,"div",15)(2,"button",16),e.NdJ("click",function(){e.CHM(o);const r=e.oxw(),a=e.MAs(7);return e.KtG(r.clear(a))}),e.qZA(),e.TgZ(3,"p-dropdown",17),e.NdJ("onChange",function(r){e.CHM(o),e.oxw();const a=e.MAs(7);return e.KtG(a.filter(r.value,"estado","contains"))})("ngModelChange",function(r){e.CHM(o);const a=e.oxw();return e.KtG(a.valorNulleable=r)}),e.qZA(),e.TgZ(4,"span",18)(5,"span",19),e._UZ(6,"i",20),e.TgZ(7,"input",21),e.NdJ("input",function(r){e.CHM(o),e.oxw();const a=e.MAs(7);return e.KtG(a.filterGlobal(r.target.value,"contains"))}),e.qZA()()()()()}if(2&s){const o=e.oxw();e.xp6(3),e.Q6J("options",o.selectEstadoOrden)("ngModel",o.valorNulleable)("showClear",!0)}}function x(s,d){if(1&s&&(e.ynx(0),e.TgZ(1,"th",23),e._uU(2),e._UZ(3,"p-sortIcon",24),e.qZA(),e.BQk()),2&s){const o=d.$implicit;e.xp6(1),e.Q6J("pSortableColumn",o.field),e.xp6(1),e.hij(" ",o.header," "),e.xp6(1),e.Q6J("field",o.field)}}function R(s,d){if(1&s&&(e.TgZ(0,"tr"),e.YNc(1,x,4,3,"ng-container",22),e.qZA()),2&s){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.cols)}}function y(s,d){if(1&s&&(e.TgZ(0,"td",27)(1,"span",28),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&s){const o=d.$implicit,t=e.oxw().$implicit;e.xp6(2),e.hij("",o.field," "),e.xp6(1),e.hij(" ",t[o.field]?t[o.field]:"N/A"," ")}}function H(s,d){if(1&s){const o=e.EpF();e.TgZ(0,"tr",25),e.NdJ("click",function(){const a=e.CHM(o).$implicit,l=e.oxw();return e.KtG(l.navegarAMostrar(a.id))}),e.YNc(1,y,4,2,"td",26),e.qZA()}if(2&s){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.cols)}}function U(s,d){1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2,"*No hay Ordenes de trabajo registradas*"),e.qZA()())}const Z=function(){return[10,20,30]},L=function(){return["descripcion","nombre"]};let I=(()=>{var s;class d{constructor(){this.url=T.N.API_URL,this.totalRecords=0,this.mostrarDel=1,this.mostrarAl=10,this.tareaService=(0,e.f3M)(g.p),this.router=(0,e.f3M)(f.F0),this.usuarioService=(0,e.f3M)(O.i),this.messageService=(0,e.f3M)(h.S),this.enumService=(0,e.f3M)(b.t),this.subs=[],this.cols=[],this.selectEstadoOrden=[],this.ordenesTrabajo=[],this.loading=!0,this.usuarios=[]}ngOnInit(){this.cols=[{field:"nombre",header:"Nombre"},{field:"descripcion",header:"Descripcion"},{field:"estado",header:"Estado"}],this.usuario=JSON.parse(localStorage.getItem("usuario")),this.cargarEstadosOrden()}applyFilterGlobal(t,r){this.dt.filterGlobal(t.target.value,"contains")}cargarEstadosOrden(){this.subs.push(this.enumService.getEnum("estado_orden_trabajo").subscribe({next:t=>this.selectEstadoOrden=t,error:t=>this.messageService.error(t.error.detail)}))}clear(t){t.clear(),document.getElementById("buscador").value="",this.valorNulleable=null}loadCustomers(t){console.log(t),this.loading=!0;const r=t.first?t.first:0,a=t.rows?t.rows:1;var i=this.url+`/ordenes_trabajo_paginate?page=${r/a+1}&itemsPerPage=${a}`;t.globalFilter&&(i+=`&nombre=${t.globalFilter}&descripcion=${t.globalFilter}`),i+=`&usuario=${this.usuario.nombre}`,t.filters.estado&&null!=t.filters.estado&&null!=t.filters.estado.value?i+=`&estado=${t.filters.estado.value}`:t.filters.estado&&null!=t.filters.estado[0]&&null!=t.filters.estado[0].value&&(i+=`&estado=${t.filters.estado[0].value.value}`),t.sortField&&(i+=`&ordenCampo=${t.sortField}`,1==t.sortOrder&&(i+="&ordenTipo=ASC"),-1==t.sortOrder&&(i+="&ordenTipo=DESC")),this.cargarOrdenesTrabajosP(i,r,a)}cargarOrdenesTrabajosP(t,r,a){this.subs.push(this.tareaService.getOrdenesTrabajosPaginadas(t).subscribe(l=>{console.log(l),this.ordenesTrabajo=l.data,this.loading=!1,this.totalRecords=l.totalItems,this.loading=!1,this.mostrarDel=r+1,this.mostrarAl=this.mostrarDel+a-1,this.mostrarAl>this.totalRecords&&(this.mostrarAl=this.totalRecords)},l=>{console.error(l),this.loading=!1,this.messageService.error(l.error.detail)}))}ngOnDestroy(){this.subs.forEach(t=>{t.unsubscribe()})}navegarAMostrar(t){console.log(t),sessionStorage.setItem("lastUrlOrden","/ordenes-trabajos-historico"),this.router.navigateByUrl(`ordenes-trabajo/mostrar/${t}`)}}return(s=d).\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-ordenes-trabajo-historico"]],viewQuery:function(t,r){if(1&t&&e.Gf(D,5),2&t){let a;e.iGM(a=e.CRH())&&(r.dt=a.first)}},standalone:!0,features:[e.jDz],decls:12,vars:16,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["styleClass","toolbar-sin-bordes"],["pTemplate","left"],[1,"mt-1"],["responsiveLayout","scroll","selectionMode","multiple","dataKey","id",3,"value","columns","lazy","loading","paginator","rows","rowsPerPageOptions","totalRecords","globalFilterFields","showCurrentPageReport","currentPageReportTemplate","rowHover","onLazyLoad"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"my-2"],[1,"mb-0"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"flex","flex-column","md:flex-row","md:justify-content-end","md:align-items-center"],["pButton","","label","Filtros","icon","pi pi-filter-slash",1,"mr-2","p-button-outlined","my-2","md:my-0",3,"click"],["id","selctEstado","placeholder","Estado",1,"mr-2","max-w-full",3,"options","ngModel","showClear","onChange","ngModelChange"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"p-input-icon-left","ml-auto"],[1,"pi","pi-search"],["id","buscador","pInputText","","input","","type","text","placeholder","Buscar",1,"max-w-max",3,"input"],[4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field"],[3,"click"],["style","min-width: 10rem",4,"ngFor","ngForOf"],[2,"min-width","10rem"],[1,"p-column-title"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-toolbar",3),e.YNc(4,A,3,0,"ng-template",4),e.qZA(),e._UZ(5,"hr",5),e.TgZ(6,"p-table",6,7),e.NdJ("onLazyLoad",function(l){return r.loadCustomers(l)}),e.YNc(8,j,8,3,"ng-template",8),e.YNc(9,R,2,1,"ng-template",9),e.YNc(10,H,2,1,"ng-template",10),e.YNc(11,U,3,0,"ng-template",11),e.qZA()()()()),2&t&&(e.xp6(6),e.cQ8("currentPageReportTemplate","Del ",r.mostrarDel," al ",r.mostrarAl," para ",r.totalRecords," Registros"),e.Q6J("value",r.ordenesTrabajo)("columns",r.cols)("lazy",!0)("loading",r.loading)("paginator",!0)("rows",10)("rowsPerPageOptions",e.DdM(14,Z))("totalRecords",r.totalRecords)("globalFilterFields",e.DdM(15,L))("showCurrentPageReport",!0)("rowHover",!0))},dependencies:[p.ez,p.sg,u.g,c.iA,C.jx,c.lQ,c.fz,E.Hq,m.JJ,m.On,M.o,P.o,v.Lt]}),d})()}}]);