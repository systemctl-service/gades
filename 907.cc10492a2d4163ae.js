"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[907],{4907:(w,_,s)=>{s.r(_),s.d(_,{OrdenesTrabajoHistoricoComponent:()=>F});var t=s(4946),p=s(6814),g=s(4430),f=s(2814),m=s(2253),T=s(8062),h=s(553),O=s(1063),b=s(8241),d=s(9250),C=s(5219),E=s(707),u=s(95),M=s(4480),P=s(6340),v=s(3714),D=s(3965);const A=["dt"],j=function(){return["/"]};function x(o,l){1&o&&t._UZ(0,"button",14),2&o&&t.Q6J("routerLink",t.DdM(1,j))}function R(o,l){}function H(o,l){1&o&&(t.TgZ(0,"div",15)(1,"h2",16),t._uU(2,"Ordenes de Trabajo"),t.qZA()())}function y(o,l){if(1&o){const r=t.EpF();t.TgZ(0,"div",17)(1,"div",18)(2,"button",19),t.NdJ("click",function(){t.CHM(r);const a=t.oxw(),n=t.MAs(10);return t.KtG(a.clear(n))}),t.qZA(),t.TgZ(3,"p-dropdown",20),t.NdJ("onChange",function(a){t.CHM(r),t.oxw();const n=t.MAs(10);return t.KtG(n.filter(a.value,"estado","contains"))})("ngModelChange",function(a){t.CHM(r);const n=t.oxw();return t.KtG(n.valorNulleable=a)}),t.qZA(),t.TgZ(4,"span",21)(5,"span",22),t._UZ(6,"i",23),t.TgZ(7,"input",24),t.NdJ("input",function(a){t.CHM(r),t.oxw();const n=t.MAs(10);return t.KtG(n.filterGlobal(a.target.value,"contains"))}),t.qZA()()()()()}if(2&o){const r=t.oxw();t.xp6(3),t.Q6J("options",r.selectEstadoOrden)("ngModel",r.valorNulleable)("showClear",!0)}}function Z(o,l){if(1&o&&(t.ynx(0),t.TgZ(1,"th",26),t._uU(2),t._UZ(3,"p-sortIcon",27),t.qZA(),t.BQk()),2&o){const r=l.$implicit;t.xp6(1),t.Q6J("pSortableColumn",r.field),t.xp6(1),t.hij(" ",r.header," "),t.xp6(1),t.Q6J("field",r.field)}}function U(o,l){if(1&o&&(t.TgZ(0,"tr"),t.YNc(1,Z,4,3,"ng-container",25),t.qZA()),2&o){const r=t.oxw();t.xp6(1),t.Q6J("ngForOf",r.cols)}}function L(o,l){if(1&o&&(t.TgZ(0,"td",30)(1,"span",31),t._uU(2),t.qZA(),t._uU(3),t.qZA()),2&o){const r=l.$implicit,e=t.oxw().$implicit;t.xp6(2),t.hij("",r.field," "),t.xp6(1),t.hij(" ",e[r.field]?e[r.field]:"N/A"," ")}}function I(o,l){if(1&o){const r=t.EpF();t.TgZ(0,"tr",28),t.NdJ("click",function(){const n=t.CHM(r).$implicit,c=t.oxw();return t.KtG(c.navegarAMostrar(n.id))}),t.YNc(1,L,4,2,"td",29),t.qZA()}if(2&o){const r=t.oxw();t.xp6(1),t.Q6J("ngForOf",r.cols)}}function B(o,l){1&o&&(t.TgZ(0,"tr")(1,"td"),t._uU(2,"*No hay Ordenes de trabajo registradas*"),t.qZA()())}const K=function(){return[10,20,30]},N=function(){return["descripcion","nombre"]};let F=(()=>{var o;class l{constructor(){this.url=h.N.API_URL,this.totalRecords=0,this.mostrarDel=1,this.mostrarAl=10,this.tareaService=(0,t.f3M)(f.p),this.router=(0,t.f3M)(m.F0),this.usuarioService=(0,t.f3M)(O.i),this.messageService=(0,t.f3M)(T.S),this.enumService=(0,t.f3M)(b.t),this.subs=[],this.cols=[],this.selectEstadoOrden=[],this.ordenesTrabajo=[],this.loading=!0,this.usuarios=[]}ngOnInit(){this.cols=[{field:"nombre",header:"Nombre"},{field:"descripcion",header:"Descripcion"},{field:"estado",header:"Estado"}],this.usuario=JSON.parse(localStorage.getItem("usuario")),this.cargarEstadosOrden()}applyFilterGlobal(e,a){this.dt.filterGlobal(e.target.value,"contains")}cargarEstadosOrden(){this.subs.push(this.enumService.getEnum("estado_orden_trabajo").subscribe({next:e=>this.selectEstadoOrden=e,error:e=>this.messageService.error(e.error.detail)}))}clear(e){e.clear(),document.getElementById("buscador").value="",this.valorNulleable=null}loadCustomers(e){console.log(e),this.loading=!0;const a=e.first?e.first:0,n=e.rows?e.rows:1;var i=this.url+`/ordenes_trabajo_paginate?page=${a/n+1}&itemsPerPage=${n}`;e.globalFilter&&(i+=`&nombre=${e.globalFilter}&descripcion=${e.globalFilter}`),i+=`&usuario=${this.usuario.nombre}`,e.filters.estado&&null!=e.filters.estado&&null!=e.filters.estado.value?i+=`&estado=${e.filters.estado.value}`:e.filters.estado&&null!=e.filters.estado[0]&&null!=e.filters.estado[0].value&&(i+=`&estado=${e.filters.estado[0].value.value}`),e.sortField&&(i+=`&ordenCampo=${e.sortField}`,1==e.sortOrder&&(i+="&ordenTipo=ASC"),-1==e.sortOrder&&(i+="&ordenTipo=DESC")),this.cargarOrdenesTrabajosP(i,a,n)}cargarOrdenesTrabajosP(e,a,n){this.subs.push(this.tareaService.getOrdenesTrabajosPaginadas(e).subscribe(c=>{console.log(c),this.ordenesTrabajo=c.data,this.loading=!1,this.totalRecords=c.totalItems,this.loading=!1,this.mostrarDel=a+1,this.mostrarAl=this.mostrarDel+n-1,this.mostrarAl>this.totalRecords&&(this.mostrarAl=this.totalRecords)},c=>{console.error(c),this.loading=!1,this.messageService.error(c.error.detail)}))}ngOnDestroy(){this.subs.forEach(e=>{e.unsubscribe()})}navegarAMostrar(e){console.log(e),sessionStorage.setItem("lastUrlOrden","/ordenes-trabajos-historico"),this.router.navigateByUrl(`ordenes-trabajo/mostrar/${e}`)}}return(o=l).\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-ordenes-trabajo-historico"]],viewQuery:function(e,a){if(1&e&&t.Gf(A,5),2&e){let n;t.iGM(n=t.CRH())&&(a.dt=n.first)}},standalone:!0,features:[t.jDz],decls:15,vars:16,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["styleClass","toolbar-sin-bordes mb-3"],["pTemplate","left"],["pTemplate","right"],["styleClass","toolbar-sin-bordes"],[1,"mt-1"],["responsiveLayout","scroll","selectionMode","multiple","dataKey","id",3,"value","columns","lazy","loading","paginator","rows","rowsPerPageOptions","totalRecords","globalFilterFields","showCurrentPageReport","currentPageReportTemplate","rowHover","onLazyLoad"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pButton","","pRipple","","type","button","icon","pi pi-replay",1,"p-button-rounded",3,"routerLink"],[1,"my-2"],[1,"mb-0"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"flex","flex-column","md:flex-row","md:justify-content-end","md:align-items-center"],["pButton","","label","Filtros","icon","pi pi-filter-slash",1,"mr-2","p-button-outlined","my-2","md:my-0",3,"click"],["id","selctEstado","placeholder","Estado",1,"mr-2","max-w-full",3,"options","ngModel","showClear","onChange","ngModelChange"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"p-input-icon-left","ml-auto"],[1,"pi","pi-search"],["id","buscador","pInputText","","input","","type","text","placeholder","Buscar",1,"max-w-max",3,"input"],[4,"ngFor","ngForOf"],[3,"pSortableColumn"],[3,"field"],[3,"click"],["style","min-width: 10rem",4,"ngFor","ngForOf"],[2,"min-width","10rem"],[1,"p-column-title"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-toolbar",3),t.YNc(4,x,1,2,"ng-template",4),t.YNc(5,R,0,0,"ng-template",5),t.qZA(),t.TgZ(6,"p-toolbar",6),t.YNc(7,H,3,0,"ng-template",4),t.qZA(),t._UZ(8,"hr",7),t.TgZ(9,"p-table",8,9),t.NdJ("onLazyLoad",function(c){return a.loadCustomers(c)}),t.YNc(11,y,8,3,"ng-template",10),t.YNc(12,U,2,1,"ng-template",11),t.YNc(13,I,2,1,"ng-template",12),t.YNc(14,B,3,0,"ng-template",13),t.qZA()()()()),2&e&&(t.xp6(9),t.cQ8("currentPageReportTemplate","Del ",a.mostrarDel," al ",a.mostrarAl," para ",a.totalRecords," Registros"),t.Q6J("value",a.ordenesTrabajo)("columns",a.cols)("lazy",!0)("loading",a.loading)("paginator",!0)("rows",10)("rowsPerPageOptions",t.DdM(14,K))("totalRecords",a.totalRecords)("globalFilterFields",t.DdM(15,N))("showCurrentPageReport",!0)("rowHover",!0))},dependencies:[p.ez,p.sg,g.g,d.iA,C.jx,d.lQ,d.fz,E.Hq,u.JJ,u.On,M.H,P.o,v.o,D.Lt,m.rH]}),l})()}}]);