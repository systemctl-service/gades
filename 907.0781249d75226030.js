"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[907],{4907:(K,p,s)=>{s.r(p),s.d(p,{OrdenesTrabajoHistoricoComponent:()=>N});var e=s(4946),d=s(6814),u=s(4430),g=s(2814),f=s(2253),h=s(8062),T=s(553),O=s(1063),C=s(8241),c=s(9250),b=s(5219),E=s(707),m=s(95),M=s(6340),x=s(3714),A=s(3965);const j=["dt"];function P(r,i){1&r&&(e.TgZ(0,"div",12)(1,"h2",13),e._uU(2,"Ordenes de Trabajo"),e.qZA()())}function v(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"div",14)(1,"div",15)(2,"button",16),e.NdJ("click",function(){e.CHM(o);const n=e.oxw(),a=e.MAs(7);return e.KtG(n.clear(a))}),e.qZA(),e.TgZ(3,"p-dropdown",17),e.NdJ("onChange",function(n){e.CHM(o),e.oxw();const a=e.MAs(7);return e.KtG(a.filter(n.value,"estado","contains"))})("ngModelChange",function(n){e.CHM(o);const a=e.oxw();return e.KtG(a.valorNulleable=n)}),e.qZA(),e.TgZ(4,"span",18)(5,"span",19),e._UZ(6,"i",20),e.TgZ(7,"input",21),e.NdJ("input",function(n){e.CHM(o),e.oxw();const a=e.MAs(7);return e.KtG(a.filterGlobal(n.target.value,"contains"))}),e.qZA()()()()()}if(2&r){const o=e.oxw();e.xp6(3),e.Q6J("options",o.selectEstadoOrden)("ngModel",o.valorNulleable)("showClear",!0)}}function D(r,i){if(1&r&&(e.TgZ(0,"th",25),e._uU(1),e._UZ(2,"p-sortIcon",26),e.qZA()),2&r){const o=e.oxw().$implicit;e.Q6J("pSortableColumn",o.field),e.xp6(1),e.hij(" ",o.header," "),e.xp6(1),e.Q6J("field",o.field)}}function w(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"p-dropdown",30),e.NdJ("onChange",function(n){const _=e.CHM(o).filterCallback;return e.KtG(_(n))}),e.qZA()}if(2&r){const o=e.oxw(5);e.Q6J("options",o.selectEstadoOrden)}}function H(r,i){if(1&r&&(e.TgZ(0,"p-columnFilter",28),e.YNc(1,w,1,1,"ng-template",29),e.qZA()),2&r){const o=e.oxw(2).$implicit;e.Q6J("field",o.field)("showMatchModes",!1)("showOperator",!1)("showAddButton",!1)("showApplyButton",!1)("showClearButton",!1)}}function y(r,i){if(1&r&&(e.TgZ(0,"th"),e._uU(1),e.YNc(2,H,2,6,"p-columnFilter",27),e.qZA()),2&r){const o=e.oxw().$implicit;e.xp6(1),e.hij(" ",o.header," "),e.xp6(1),e.Q6J("ngIf","Estado"===o.header)}}function Z(r,i){if(1&r&&(e.ynx(0),e.YNc(1,D,3,3,"th",23),e.YNc(2,y,3,2,"ng-template",null,24,e.W1O),e.BQk()),2&r){const o=i.$implicit,t=e.MAs(3);e.xp6(1),e.Q6J("ngIf","Asignado"!==o.header&&"Estado"!==o.header)("ngIfElse",t)}}function R(r,i){if(1&r&&(e.TgZ(0,"tr"),e.YNc(1,Z,4,2,"ng-container",22),e.qZA()),2&r){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.cols)}}function B(r,i){if(1&r&&(e.TgZ(0,"td",33)(1,"span",34),e._uU(2),e.qZA(),e._uU(3),e.qZA()),2&r){const o=i.$implicit,t=e.oxw().$implicit;e.xp6(2),e.hij("",o.field," "),e.xp6(1),e.hij(" ",t[o.field]?t[o.field]:"N/A"," ")}}function I(r,i){if(1&r){const o=e.EpF();e.TgZ(0,"tr",31),e.NdJ("click",function(){const a=e.CHM(o).$implicit,_=e.oxw();return e.KtG(_.navegarAMostrar(a.id))}),e.YNc(1,B,4,2,"td",32),e.qZA()}if(2&r){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.cols)}}function U(r,i){1&r&&(e.TgZ(0,"tr")(1,"td"),e._uU(2,"*No hay Ordenes de trabajo registradas*"),e.qZA()())}const F=function(){return[10,20,30]},L=function(){return["descripcion","nombre"]};let N=(()=>{var r;class i{constructor(){this.url=T.N.API_URL,this.totalRecords=0,this.mostrarDel=1,this.mostrarAl=10,this.tareaService=(0,e.f3M)(g.p),this.router=(0,e.f3M)(f.F0),this.usuarioService=(0,e.f3M)(O.i),this.messageService=(0,e.f3M)(h.S),this.enumService=(0,e.f3M)(C.t),this.subs=[],this.cols=[],this.selectEstadoOrden=[],this.ordenesTrabajo=[],this.loading=!0,this.usuarios=[]}ngOnInit(){this.cols=[{field:"nombre",header:"Nombre"},{field:"descripcion",header:"Descripcion"},{field:"estado",header:"Estado"}],this.usuario=JSON.parse(localStorage.getItem("usuario")),this.cargarEstadosOrden()}applyFilterGlobal(t,n){this.dt.filterGlobal(t.target.value,"contains")}cargarEstadosOrden(){this.subs.push(this.enumService.getEnum("estado_orden_trabajo").subscribe({next:t=>this.selectEstadoOrden=t,error:t=>this.messageService.error(t.error.detail)}))}clear(t){t.clear(),document.getElementById("buscador").value="",this.valorNulleable=null}loadCustomers(t){console.log(t),this.loading=!0;const n=t.first?t.first:0,a=t.rows?t.rows:1;var l=this.url+`/ordenes_trabajo_paginate?page=${n/a+1}&itemsPerPage=${a}`;t.globalFilter&&(l+=`&nombre=${t.globalFilter}&descripcion=${t.globalFilter}`),l+=`&usuario=${this.usuario.nombre}`,t.filters.estado&&null!=t.filters.estado&&null!=t.filters.estado.value?l+=`&estado=${t.filters.estado.value}`:t.filters.estado&&null!=t.filters.estado[0]&&null!=t.filters.estado[0].value&&(l+=`&estado=${t.filters.estado[0].value.value}`),t.sortField&&(l+=`&ordenCampo=${t.sortField}`,1==t.sortOrder&&(l+="&ordenTipo=ASC"),-1==t.sortOrder&&(l+="&ordenTipo=DESC")),this.cargarOrdenesTrabajosP(l,n,a)}cargarOrdenesTrabajosP(t,n,a){this.subs.push(this.tareaService.getOrdenesTrabajosPaginadas(t).subscribe(_=>{console.log(_),this.ordenesTrabajo=_.data,this.loading=!1,this.totalRecords=_.totalItems,this.loading=!1,this.mostrarDel=n+1,this.mostrarAl=this.mostrarDel+a-1,this.mostrarAl>this.totalRecords&&(this.mostrarAl=this.totalRecords)},_=>{console.error(_),this.loading=!1,this.messageService.error(_.error.detail)}))}ngOnDestroy(){this.subs.forEach(t=>{t.unsubscribe()})}navegarAMostrar(t){console.log(t),sessionStorage.setItem("lastUrlOrden","/ordenes-trabajos-historico"),this.router.navigateByUrl(`ordenes-trabajo/mostrar/${t}`)}}return(r=i).\u0275fac=function(t){return new(t||r)},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-ordenes-trabajo-historico"]],viewQuery:function(t,n){if(1&t&&e.Gf(j,5),2&t){let a;e.iGM(a=e.CRH())&&(n.dt=a.first)}},standalone:!0,features:[e.jDz],decls:12,vars:16,consts:[[1,"grid"],[1,"col-12"],[1,"card","px-6","py-6"],["styleClass","toolbar-sin-bordes"],["pTemplate","left"],[1,"mt-1"],["responsiveLayout","scroll","selectionMode","multiple","dataKey","id",3,"value","columns","lazy","loading","paginator","rows","rowsPerPageOptions","totalRecords","globalFilterFields","showCurrentPageReport","currentPageReportTemplate","rowHover","onLazyLoad"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"my-2"],[1,"mb-0"],[1,"flex","flex-column","md:flex-row","md:justify-content-between","md:align-items-center"],[1,"flex","flex-column","md:flex-row","md:justify-content-end","md:align-items-center"],["pButton","","label","Filtros","icon","pi pi-filter-slash",1,"mr-2","p-button-outlined","my-2","md:my-0",3,"click"],["id","selctEstado","placeholder","Estado",1,"mr-2","max-w-full",3,"options","ngModel","showClear","onChange","ngModelChange"],[1,"block","mt-2","md:mt-0","p-input-icon-left"],[1,"p-input-icon-left","ml-auto"],[1,"pi","pi-search"],["id","buscador","pInputText","","input","","type","text","placeholder","Buscar",1,"max-w-max",3,"input"],[4,"ngFor","ngForOf"],[3,"pSortableColumn",4,"ngIf","ngIfElse"],["asigEstado",""],[3,"pSortableColumn"],[3,"field"],["matchMode","in","display","menu",3,"field","showMatchModes","showOperator","showAddButton","showApplyButton","showClearButton",4,"ngIf"],["matchMode","in","display","menu",3,"field","showMatchModes","showOperator","showAddButton","showApplyButton","showClearButton"],["pTemplate","filter"],["placeholder","Estado de la Orden",1,"w-3rem",3,"options","onChange"],[3,"click"],["style","min-width: 10rem",4,"ngFor","ngForOf"],[2,"min-width","10rem"],[1,"p-column-title"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"p-toolbar",3),e.YNc(4,P,3,0,"ng-template",4),e.qZA(),e._UZ(5,"hr",5),e.TgZ(6,"p-table",6,7),e.NdJ("onLazyLoad",function(_){return n.loadCustomers(_)}),e.YNc(8,v,8,3,"ng-template",8),e.YNc(9,R,2,1,"ng-template",9),e.YNc(10,I,2,1,"ng-template",10),e.YNc(11,U,3,0,"ng-template",11),e.qZA()()()()),2&t&&(e.xp6(6),e.cQ8("currentPageReportTemplate","Del ",n.mostrarDel," al ",n.mostrarAl," para ",n.totalRecords," Registros"),e.Q6J("value",n.ordenesTrabajo)("columns",n.cols)("lazy",!0)("loading",n.loading)("paginator",!0)("rows",10)("rowsPerPageOptions",e.DdM(14,F))("totalRecords",n.totalRecords)("globalFilterFields",e.DdM(15,L))("showCurrentPageReport",!0)("rowHover",!0))},dependencies:[d.ez,d.sg,d.O5,u.g,c.iA,b.jx,c.lQ,c.fz,c.xl,E.Hq,m.JJ,m.On,M.o,x.o,A.Lt]}),i})()}}]);